// you have to copy image into clipboard and have a smart layer named "design" to do this.// watches for automation.psd// have to select a layer not in a group that is not "Design" layervar maindoc = app.activeDocument;app.activeDocument.activeLayer = app.activeDocument.layers[0];function resizeLayer(){    var maintainAspectRatio;// set to true to keep aspect ratio      if(app.documents.length>0){          app.activeDocument.suspendHistory ('Fit Layer to Canvas', 'FitLayerToCanvas('+maintainAspectRatio+')');      }      function FitLayerToCanvas( keepAspect ){// keepAspect:Boolean - optional. Default to false          var doc = app.activeDocument;          var layer = doc.activeLayer;          // do nothing if layer is background or locked          if(layer.isBackgroundLayer || layer.allLocked || layer.pixelsLocked                                  || layer.positionLocked || layer.transparentPixelsLocked ) return;          // do nothing if layer is not normal artLayer or Smart Object          if( layer.kind != LayerKind.NORMAL && layer.kind != LayerKind.SMARTOBJECT) return;          // store the ruler          var defaultRulerUnits = app.preferences.rulerUnits;          app.preferences.rulerUnits = Units.PIXELS;                    var width = doc.width.as('px');          var height =doc.height.as('px');          var bounds = app.activeDocument.activeLayer.bounds;          var layerWidth = bounds[2].as('px')-bounds[0].as('px');          var layerHeight = bounds[3].as('px')-bounds[1].as('px');                        // move the layer so top left corner matches canvas top left corner          layer.translate(new UnitValue(0-layer.bounds[0].as('px'),'px'), new UnitValue(0-layer.bounds[1].as('px'),'px'));          if( !keepAspect ){              // scale the layer to match canvas              layer.resize( (width/layerWidth)*100,(height/layerHeight)*100,AnchorPosition.TOPLEFT);          }else{              var layerRatio = layerWidth / layerHeight;              var newWidth = width;              var newHeight = ((1.0 * width) / layerRatio);              if (newHeight >= height) {                  newWidth = layerRatio * height;                  newHeight = height;              }              var resizePercent = newWidth/layerWidth*100;              app.activeDocument.activeLayer.resize(resizePercent,resizePercent,AnchorPosition.TOPLEFT);          }          // restore the ruler          app.preferences.rulerUnits = defaultRulerUnits;      }  } //set active layer as "design"function setDesignLayerAsActive(){    function getIndexByName(layerName) {        for (var i = 0; i < app.activeDocument.layers.length; i++) {             var customName = layerName; //layerName should be string            var myLayer = app.activeDocument.layers[i].name;            if (customName == myLayer) {                return i;            }        }    };    var layerIndex = getIndexByName("design");    app.activeDocument.activeLayer=app.activeDocument.layers[layerIndex];}// edit smart obectfunction editSmartObject(){    var idAction = stringIDToTypeID( "placedLayerEditContents" );	    var idDesc = new ActionDescriptor();    executeAction(idAction, idDesc, DialogModes.NO);}setDesignLayerAsActive();editSmartObject();var smartobject = app.activeDocument;$.sleep(2000) // not sure why but needs time to paste else it errors?var doc = activeDocument;var layers = doc.artLayers;var newLayer = layers.add();$.sleep(2000) // not sure why but needs time to paste else it errors?app.activeDocument.paste();resizeLayer();smartobject.close(SaveOptions.SAVECHANGES);